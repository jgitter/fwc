package org.gitter.fwc.ckan;

import java.util.List;
import java.util.Map;

import org.gitter.fwc.ckan.CkanResponseEntity.ResultWrapperEntity;
import org.junit.Assert;
import org.junit.Test;

import com.fasterxml.jackson.databind.ObjectMapper;

public class CkanResponseEntityTest {

    @Test
    public void testCreate() throws Exception {
        // setup
        String json = "{ \"help\" : \"Helpful things here\", \"success\" : true, \"result\" : { \"resource_id\" : \"some.resource.id\", \"fields\" : [ { \"type\" : \"int4\", \"id\" : \"_id\" }, { \"type\" : \"numeric\", \"id\" : \"UNITID\" }, { \"type\" : \"text\", \"id\" : \"INSTNM\" }, { \"type\" : \"text\", \"id\" : \"ADDR\" }, { \"type\" : \"text\", \"id\" : \"CITY\" }, { \"type\" : \"text\", \"id\" : \"STABBR\" }, { \"type\" : \"text\", \"id\" : \"ZIP\" }, { \"type\" : \"numeric\", \"id\" : \"FIPS\" }, { \"type\" : \"numeric\", \"id\" : \"OBEREG\" }, { \"type\" : \"text\", \"id\" : \"CHFNM\" }, { \"type\" : \"text\", \"id\" : \"CHFTITLE\" }, { \"type\" : \"text\", \"id\" : \"GENTELE\" }, { \"type\" : \"text\", \"id\" : \"FAXTELE\" }, { \"type\" : \"numeric\", \"id\" : \"EIN\" }, { \"type\" : \"numeric\", \"id\" : \"OPEID\" }, { \"type\" : \"numeric\", \"id\" : \"OPEFLAG\" }, { \"type\" : \"text\", \"id\" : \"WEBADDR\" }, { \"type\" : \"text\", \"id\" : \"ADMINURL\" }, { \"type\" : \"text\", \"id\" : \"FAIDURL\" }, { \"type\" : \"text\", \"id\" : \"APPLURL\" }, { \"type\" : \"text\", \"id\" : \"NPRICURL\" }, { \"type\" : \"numeric\", \"id\" : \"SECTOR\" }, { \"type\" : \"numeric\", \"id\" : \"ICLEVEL\" }, { \"type\" : \"numeric\", \"id\" : \"CONTROL\" }, { \"type\" : \"numeric\", \"id\" : \"HLOFFER\" }, { \"type\" : \"numeric\", \"id\" : \"UGOFFER\" }, { \"type\" : \"numeric\", \"id\" : \"GROFFER\" }, { \"type\" : \"numeric\", \"id\" : \"HDEGOFR1\" }, { \"type\" : \"numeric\", \"id\" : \"DEGGRANT\" }, { \"type\" : \"numeric\", \"id\" : \"HBCU\" }, { \"type\" : \"numeric\", \"id\" : \"HOSPITAL\" }, { \"type\" : \"numeric\", \"id\" : \"MEDICAL\" }, { \"type\" : \"numeric\", \"id\" : \"TRIBAL\" }, { \"type\" : \"numeric\", \"id\" : \"LOCALE\" }, { \"type\" : \"numeric\", \"id\" : \"OPENPUBL\" }, { \"type\" : \"text\", \"id\" : \"ACT\" }, { \"type\" : \"numeric\", \"id\" : \"NEWID\" }, { \"type\" : \"numeric\", \"id\" : \"DEATHYR\" }, { \"type\" : \"timestamp\", \"id\" : \"CLOSEDAT\" }, { \"type\" : \"numeric\", \"id\" : \"CYACTIVE\" }, { \"type\" : \"numeric\", \"id\" : \"POSTSEC\" }, { \"type\" : \"numeric\", \"id\" : \"PSEFLAG\" }, { \"type\" : \"numeric\", \"id\" : \"PSET4FLG\" }, { \"type\" : \"numeric\", \"id\" : \"RPTMTH\" }, { \"type\" : \"text\", \"id\" : \"IALIAS\" }, { \"type\" : \"numeric\", \"id\" : \"INSTCAT\" }, { \"type\" : \"numeric\", \"id\" : \"CCBASIC\" }, { \"type\" : \"numeric\", \"id\" : \"CCIPUG\" }, { \"type\" : \"numeric\", \"id\" : \"CCIPGRAD\" }, { \"type\" : \"numeric\", \"id\" : \"CCUGPROF\" }, { \"type\" : \"numeric\", \"id\" : \"CCENRPRF\" }, { \"type\" : \"numeric\", \"id\" : \"CCSIZSET\" }, { \"type\" : \"numeric\", \"id\" : \"CARNEGIE\" }, { \"type\" : \"numeric\", \"id\" : \"LANDGRNT\" }, { \"type\" : \"numeric\", \"id\" : \"INSTSIZE\" }, { \"type\" : \"numeric\", \"id\" : \"CBSA\" }, { \"type\" : \"numeric\", \"id\" : \"CBSATYPE\" }, { \"type\" : \"numeric\", \"id\" : \"CSA\" }, { \"type\" : \"numeric\", \"id\" : \"NECTA\" }, { \"type\" : \"numeric\", \"id\" : \"F1SYSTYP\" }, { \"type\" : \"text\", \"id\" : \"F1SYSNAM\" }, { \"type\" : \"numeric\", \"id\" : \"F1SYSCOD\" }, { \"type\" : \"numeric\", \"id\" : \"COUNTYCD\" }, { \"type\" : \"text\", \"id\" : \"COUNTYNM\" }, { \"type\" : \"numeric\", \"id\" : \"CNGDSTCD\" }, { \"type\" : \"numeric\", \"id\" : \"LONGITUD\" }, { \"type\" : \"numeric\", \"id\" : \"LATITUDE\" }, { \"type\" : \"int8\", \"id\" : \"_full_count\" }, { \"type\" : \"float4\", \"id\" : \"rank\" } ], \"q\" : \"fake\", \"records\" : [ { \"SECTOR\" : \"2\", \"STABBR\" : \"WI\", \"_full_count\" : \"36\", \"CHFTITLE\" : \"President\", \"FAXTELE\" : \"4142883764\", \"CBSATYPE\" : \"1\", \"LOCALE\" : \"11\", \"MEDICAL\" : \"1\", \"APPLURL\" : \"www.marquette.edu/student/applytoday.shtml\", \"CARNEGIE\" : \"15\", \"OBEREG\" : \"3\", \"CBSA\" : \"33340\", \"NEWID\" : \"-2\", \"ACT\" : \"A \", \"CCSIZSET\" : \"17\", \"LANDGRNT\" : \"2\", \"UGOFFER\" : \"1\", \"OPEFLAG\" : \"1\", \"CONTROL\" : \"2\", \"WEBADDR\" : \"www.marquette.edu\", \"INSTSIZE\" : \"4\", \"CYACTIVE\" : \"1\", \"GROFFER\" : \"1\", \"HLOFFER\" : \"9\", \"HOSPITAL\" : \"2\", \"ICLEVEL\" : \"1\", \"CLOSEDAT\" : \"2015-01-02T00:00:00\", \"FAIDURL\" : \"www.marquette.edu/about/fin_aid.shtml\", \"INSTNM\" : \"Marquette University\", \"HDEGOFR1\" : \"11\", \"LONGITUD\" : \"-87.928121\", \"DEGGRANT\" : \"1\", \"EIN\" : \"390806251\", \"NECTA\" : \"-2\", \"CCIPGRAD\" : \"14\", \"HBCU\" : \"2\", \"ZIP\" : \"53233\", \"GENTELE\" : \"4142887710\", \"ADMINURL\" : \"www.marquette.edu/student/\", \"COUNTYNM\" : \"Milwaukee County\", \"F1SYSNAM\" : \" \", \"CHFNM\" : \"Dr. Michael Lovell\", \"CSA\" : \"376\", \"COUNTYCD\" : \"55079\", \"IALIAS\" : \" \", \"F1SYSCOD\" : \"-2\", \"CCBASIC\" : \"17\", \"FIPS\" : \"55\", \"rank\" : 0.090759300000000001, \"UNITID\" : \"239105\", \"INSTCAT\" : \"2\", \"OPEID\" : \"386300\", \"PSEFLAG\" : \"1\", \"POSTSEC\" : \"1\", \"NPRICURL\" : \"www.marquette.edu/student-aid-calculator/\", \"CITY\" : \"Milwaukee\", \"OPENPUBL\" : \"1\", \"ADDR\" : \"1250 W Wisconsin Avenue\", \"F1SYSTYP\" : \"2\", \"TRIBAL\" : \"2\", \"CCENRPRF\" : \"4\", \"DEATHYR\" : \"-2\", \"RPTMTH\" : \"1\", \"CCUGPROF\" : \"12\", \"LATITUDE\" : \"43.038766\", \"PSET4FLG\" : \"1\", \"CNGDSTCD\" : \"5504\", \"_id\" : 4340, \"CCIPUG\" : \"10\" }, { \"SECTOR\" : \"2\", \"STABBR\" : \"WI\", \"_full_count\" : \"36\", \"CHFTITLE\" : \"President\", \"FAXTELE\" : \"4142777475\", \"CBSATYPE\" : \"1\", \"LOCALE\" : \"11\", \"MEDICAL\" : \"2\", \"APPLURL\" : \"www.msoe.edu/apply\", \"CARNEGIE\" : \"54\", \"OBEREG\" : \"3\", \"CBSA\" : \"33340\", \"NEWID\" : \"-2\", \"ACT\" : \"A \", \"CCSIZSET\" : \"10\", \"LANDGRNT\" : \"2\", \"UGOFFER\" : \"1\", \"OPEFLAG\" : \"1\", \"CONTROL\" : \"2\", \"WEBADDR\" : \"www.msoe.edu\", \"INSTSIZE\" : \"2\", \"CYACTIVE\" : \"1\", \"GROFFER\" : \"1\", \"HLOFFER\" : \"7\", \"HOSPITAL\" : \"2\", \"ICLEVEL\" : \"1\", \"CLOSEDAT\" : \"2015-01-02T00:00:00\", \"FAIDURL\" : \"www.msoe.edu/finaid\", \"INSTNM\" : \"Milwaukee School of Engineering\", \"HDEGOFR1\" : \"20\", \"LONGITUD\" : \"-87.907691\", \"DEGGRANT\" : \"1\", \"EIN\" : \"390477970\", \"NECTA\" : \"-2\", \"CCIPGRAD\" : \"8\", \"HBCU\" : \"2\", \"ZIP\" : \"53202-3109\", \"GENTELE\" : \"8003326763\", \"ADMINURL\" : \"www.msoe.edu/admission\", \"COUNTYNM\" : \"Milwaukee County\", \"F1SYSNAM\" : \" \", \"CHFNM\" : \"Hermann Viets\", \"CSA\" : \"376\", \"COUNTYCD\" : \"55079\", \"IALIAS\" : \"MSOE\", \"F1SYSCOD\" : \"-2\", \"CCBASIC\" : \"20\", \"FIPS\" : \"55\", \"rank\" : 0.136186, \"UNITID\" : \"239318\", \"INSTCAT\" : \"2\", \"OPEID\" : \"386800\", \"PSEFLAG\" : \"1\", \"POSTSEC\" : \"1\", \"NPRICURL\" : \"www.msoe.edu/financial-aid/net-price.shtml\", \"CITY\" : \"Milwaukee\", \"OPENPUBL\" : \"1\", \"ADDR\" : \"1025 N Broadway\", \"F1SYSTYP\" : \"2\", \"TRIBAL\" : \"2\", \"CCENRPRF\" : \"3\", \"DEATHYR\" : \"-2\", \"RPTMTH\" : \"1\", \"CCUGPROF\" : \"13\", \"LATITUDE\" : \"43.045364\", \"PSET4FLG\" : \"1\", \"CNGDSTCD\" : \"5504\", \"_id\" : 4346, \"CCIPUG\" : \"16\" }, { \"SECTOR\" : \"1\", \"STABBR\" : \"WI\", \"_full_count\" : \"36\", \"CHFTITLE\" : \"Chancellor\", \"FAXTELE\" : \"6082630544\", \"CBSATYPE\" : \"1\", \"LOCALE\" : \"11\", \"MEDICAL\" : \"2\", \"APPLURL\" : \"https://apply.wisconsin.edu\", \"CARNEGIE\" : \"15\", \"OBEREG\" : \"3\", \"CBSA\" : \"33340\", \"NEWID\" : \"-2\", \"ACT\" : \"A \", \"CCSIZSET\" : \"15\", \"LANDGRNT\" : \"2\", \"UGOFFER\" : \"1\", \"OPEFLAG\" : \"1\", \"CONTROL\" : \"1\", \"WEBADDR\" : \"www.uwm.edu\", \"INSTSIZE\" : \"5\", \"CYACTIVE\" : \"1\", \"GROFFER\" : \"1\", \"HLOFFER\" : \"9\", \"HOSPITAL\" : \"2\", \"ICLEVEL\" : \"1\", \"CLOSEDAT\" : \"2015-01-02T00:00:00\", \"FAIDURL\" : \"www4.uwm.edu/financialaid/\", \"INSTNM\" : \"University of Wisconsin-Milwaukee\", \"HDEGOFR1\" : \"11\", \"LONGITUD\" : \"-87.880488\", \"DEGGRANT\" : \"1\", \"EIN\" : \"396006492\", \"NECTA\" : \"-2\", \"CCIPGRAD\" : \"15\", \"HBCU\" : \"2\", \"ZIP\" : \"53201-0413\", \"GENTELE\" : \"4142291122\", \"ADMINURL\" : \"www4.uwm.edu/admission/\", \"COUNTYNM\" : \"Milwaukee County\", \"F1SYSNAM\" : \"University of Wisconsin System\", \"CHFNM\" : \"Michael R. Lovell\", \"CSA\" : \"376\", \"COUNTYCD\" : \"55079\", \"IALIAS\" : \"UWM\", \"F1SYSCOD\" : \"155010\", \"CCBASIC\" : \"16\", \"FIPS\" : \"55\", \"rank\" : 0.14974599999999999, \"UNITID\" : \"240453\", \"INSTCAT\" : \"2\", \"OPEID\" : \"389600\", \"PSEFLAG\" : \"1\", \"POSTSEC\" : \"1\", \"NPRICURL\" : \"www4.uwm.edu/financialaid/calculator/NPC/\", \"CITY\" : \"Milwaukee\", \"OPENPUBL\" : \"1\", \"ADDR\" : \"2200 E Kenwood Blvd\", \"F1SYSTYP\" : \"1\", \"TRIBAL\" : \"2\", \"CCENRPRF\" : \"4\", \"DEATHYR\" : \"-2\", \"RPTMTH\" : \"1\", \"CCUGPROF\" : \"11\", \"LATITUDE\" : \"43.076848\", \"PSET4FLG\" : \"1\", \"CNGDSTCD\" : \"5504\", \"_id\" : 4382, \"CCIPUG\" : \"11\" } ], \"_links\" : { \"start\" : \"start-url\", \"next\" : \"next-url\" }, \"total\" : 3 } }";

        // test
        CkanResponseEntity entity = new ObjectMapper().readValue(json, CkanResponseEntity.class);

        // verify
        Assert.assertEquals(true, entity.getSuccess());
        Assert.assertEquals("Helpful things here", entity.getHelp());

        ResultWrapperEntity result = entity.getResult();
        Assert.assertNotNull(result);
        Assert.assertEquals("some.resource.id", result.getResourceId());
        Assert.assertEquals(69, result.getFields().size());

        List<Map<String, String>> records = result.getRecords();
        Assert.assertNotNull(records);
        Assert.assertEquals(3, records.size());

        Assert.assertEquals("Marquette University", records.get(0).get("INSTNM"));
        Assert.assertEquals("Milwaukee School of Engineering", records.get(1).get("INSTNM"));
        Assert.assertEquals("University of Wisconsin-Milwaukee", records.get(2).get("INSTNM"));
    }
}
